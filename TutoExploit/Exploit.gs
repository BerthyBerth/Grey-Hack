metax = include_lib("/lib/metaxploit.so")
if not metax then
	currentPath = get_shell.host_computer.current_path
	metax = include_lib(currentPath + "/metaxploit.so")
end if
if not metax then exit("Error: Can't find metaxploit library in the /lib path or the current folder")
metaxVersion = metax.load("/lib/metaxploit.so")
if not metaxVersion then
	currentPath = get_shell.host_computer.current_path
	metaxVersion = metax.load(currentPath + "/metaxploit.so")
end if
metaxVersion = metaxVersion.version

kernel = metax.load("/lib/kernel_module.so")
if not kernel then
	currentPath = get_shell.host_computer.current_path
	kernel = include_lib(currentPath + "/kernel_module.so")
end if
if not kernel then exit("Error: Can't find kernel_router library in the /lib path or the current folder")

crypto = include_lib("/lib/crypto.so")
if not crypto then
	currentPath = get_shell.host_computer.current_path
	crypto = include_lib(currentPath + "/crypto.so")
end if
if not crypto then exit("Error: Can't find crypto.so library in the /lib path or the current folder")

if params.len < 3 then exit("<b>Usage: exploit [IP] [Port] [Address] [unsec_value]")
victim_ip = params[0]
victim_port = params[1]
victim_address = params[2]
unsec_value = params[3]

// ------------------------------------------

Exploit = function(value, address, extra)
    if extra == null then
        result = metax.net_use(victim_ip, victim_port.to_int).dump_lib.overflow(address, value)
    else
        result = metax.net_use(victim_ip, victim_port.to_int).dump_lib.overflow(address, value, extra)
   end if

    return result
end function

AskIfWorked = function()
    print("Why the exploit didnt worked ?")
    print("[1] Password Change")
    print("[2] Requirements not met")

    result = user_input("<b>Choice :</b> ")

    if result == "1" then
        newPassword = user_input("<b>New Password :</b> ")
        Exploit(unsec_value, victim_address, newPassword)
    end if
end function

// ------------------------------------------

if typeof(Exploit(unsec_value, victim_address)) == "null" then
    AskIfWorked()
end if
